# Compact syntax version of the GraphState protocol

namespace oxmeta = "https://chaste.comlab.ox.ac.uk/cellml/ns/oxford-metadata#"

import "../../../src/proto/library/BasicLibrary.txt"

units {
    ms = milli second
}

model interface {
    independent var units ms
    output oxmeta:time
    output oxmeta:state_variable
}

tasks {
    simulation sim = timecourse {
        range time units ms uniform 0:1:1000
    }
}

post-processing {
    state_trans = Transpose(sim:state_variable)
    
    # Check the transpose function
    assert sim:state_variable.NUM_DIMS == state_trans.NUM_DIMS
    assert sim:state_variable.SHAPE[0] == state_trans.SHAPE[1]
    assert sim:state_variable.SHAPE[1] == state_trans.SHAPE[0]
}

outputs {
    raw_state = sim:state_variable "State variables (raw)"
    state = state_trans units various "State variables"
    time = sim:time "Time"
}

plots {
    plot "State variables" { state against time }
}
